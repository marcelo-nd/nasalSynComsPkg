% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/nasalPkgFunctions.R
\name{barplots_grid}
\alias{barplots_grid}
\title{Create a Grid of Relative Abundance Barplots Across Experiments}
\usage{
barplots_grid(
  feature_tables,
  experiments_names,
  shared_samples = FALSE,
  strains = FALSE,
  plot_title = "",
  plot_title_size = 14,
  x_axis_text_size = 12,
  x_axis_title_size = 12,
  x_axis_text_angle = 0,
  y_axis_title_size = 12,
  y_axis_text_size = 12,
  y_axis_text_angle = 0,
  legend_pos = "right",
  legend_title_size = 12,
  legend_text_size = 12,
  legend_cols = 3,
  legend_key_size = 1,
  colour_palette = NULL
)
}
\arguments{
\item{feature_tables}{A list of numeric matrices or data frames, where rows
represent features (e.g., taxa/strains) and columns represent samples. Each
element of the list corresponds to one experiment or condition.}

\item{experiments_names}{Character vector of the same length as
\code{feature_tables}, giving the experiment/treatment name for each
feature table. These names are used to annotate and facet the plots.}

\item{shared_samples}{Logical. If \code{TRUE}, assumes that the same samples
are shared across experiments and plots \code{experiment} on the x-axis
with \code{sample} as facets. If \code{FALSE} (default), plots
\code{sample} on the x-axis and facets by \code{experiment}.}

\item{strains}{Logical. If \code{TRUE}, treats row names of each feature
table as strain-level identifiers of the form
\code{"Genus species strainID"} and uses \code{\link{strain_name2strain_number}}
and pattern aesthetics (\pkg{ggpattern}) to represent strains. Default
is \code{FALSE}.}

\item{plot_title}{Character string. Overall title for the plot. Default is
an empty string.}

\item{plot_title_size}{Numeric. Text size for the plot title. Default is
\code{14}.}

\item{x_axis_text_size}{Numeric. Text size for x-axis tick labels. Default
is \code{12}.}

\item{x_axis_title_size}{Numeric. Text size for the x-axis title. Default
is \code{12}.}

\item{x_axis_text_angle}{Numeric. Rotation angle (in degrees) for x-axis
tick labels. Default is \code{0}.}

\item{y_axis_title_size}{Numeric. Text size for the y-axis title. Default
is \code{12}.}

\item{y_axis_text_size}{Numeric. Text size for y-axis tick labels. Default
is \code{12}.}

\item{y_axis_text_angle}{Numeric. Rotation angle (in degrees) for y-axis
tick labels. Default is \code{0}.}

\item{legend_pos}{Character string specifying the legend position (e.g.,
\code{"right"}, \code{"bottom"}, \code{"none"}). Passed to
\code{theme(legend.position = ...)}. Default is \code{"right"}.}

\item{legend_title_size}{Numeric. Text size for legend title. Default is
\code{12}.}

\item{legend_text_size}{Numeric. Text size for legend text. Default is
\code{12}.}

\item{legend_cols}{Integer. Number of columns in the legend for the
\code{fill} aesthetic. Default is \code{3}.}

\item{legend_key_size}{Numeric. Size (in cm) of the legend key boxes.
Default is \code{1}.}

\item{colour_palette}{Optional named character vector of colors used for
species (or species groups). Names should match the values in
\code{species} (or \code{species2} when \code{strains = TRUE}). If
\code{NULL}, a palette is generated by \code{\link{get_palette}}.}
}
\value{
A \code{ggplot} object representing the faceted grid of barplots.
}
\description{
Builds a faceted grid of stacked relative abundance barplots from multiple
feature tables (e.g., OTU/ASV count tables or relative abundance tables),
typically corresponding to different experiments or treatments.
}
\details{
Each feature table is reshaped to long format, combined into a single data
frame, and plotted as stacked bars either:
\itemize{
\item per sample, faceted by experiment (default), or
\item per experiment, faceted by sample (when \code{shared_samples = TRUE}).
}

Optionally, strain-level information can be encoded using patterns
(\pkg{ggpattern}) while species are encoded by fill color.

For each feature table, the function:
\itemize{
\item Optionally renames strain-level rows using
\code{\link{strain_name2strain_number}} when \code{strains = TRUE}.
\item Filters out features with all-zero counts using
\code{\link{filter_features_by_col_counts}}.
\item Drops samples (columns) that contain only zeros.
\item Converts row names to a \code{species} column and reshapes the table
to long format using \pkg{tidyr::gather}.
\item Adds an \code{experiment} column from \code{experiments_names}.
}

When \code{strains = TRUE}, additional columns \code{strain} and
\code{species2} are created:
\itemize{
\item \code{strain}: a label like \code{"Strain 1"}, \code{"Strain 2"}, etc.
\item \code{species2}: the species name without the trailing numeric ID.
}

The final combined long data frame is filtered to remove zero abundances,
converted to factors with \code{experiment} levels matching
\code{experiments_names}, and plotted using \pkg{ggplot2}:
\itemize{
\item If \code{shared_samples = FALSE}, x-axis = \code{sample}, faceted
by \code{experiment}.
\item If \code{shared_samples = TRUE}, x-axis = \code{experiment}, faceted
by \code{sample}.
\item For \code{strains = TRUE}, \pkg{ggpattern} is used to distinguish
strains by patterns while species are distinguished by fill colors.
\item For \code{strains = FALSE}, a standard stacked barplot is created
with \code{species} as fill.
}

Relative abundances are shown as fractions of 1 via
\code{position = "fill"}.
}
\examples{
\dontrun{
p <- barplots_grid(
  feature_tables   = list(exp1_abund, exp2_abund),
  experiments_names = c("Experiment 1", "Experiment 2"),
  shared_samples   = FALSE,
  strains          = FALSE,
  plot_title       = "Relative abundance across experiments"
)
p
}

}
