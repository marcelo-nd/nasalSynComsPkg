% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/nasalPkgFunctions.R
\name{cluster_samples}
\alias{cluster_samples}
\title{Cluster samples based on relative abundance profiles}
\usage{
cluster_samples(abundance_df, k = NULL)
}
\arguments{
\item{abundance_df}{A numeric matrix or data.frame with features (e.g. OTUs,
species) in rows and samples in columns.}

\item{k}{Optional integer. Number of clusters to use for PAM. If \code{NULL}
(default), K is estimated using the average silhouette width over
K = 2,...,K_max, where K_max = \code{min(10, n_samples - 1)}.}
}
\value{
A list with the following elements:
\describe{
\item{clusters}{A data.frame with columns \code{Sample} and \code{Cluster}
containing the PAM cluster assignment for each sample.}
\item{best_k}{The number of clusters used (either provided via \code{k} or
estimated using the silhouette method).}
\item{rel_abundance_ordered}{A data.frame of relative abundances with
samples ordered according to the hierarchical clustering dendrogram.}
\item{sample_order}{Character vector of sample names in dendrogram order.}
}
}
\description{
Performs sample clustering on a feature (OTU) table using relative abundance,
hierarchical clustering (Ward.D2), and PAM clustering with silhouette-based
estimation of the optimal number of clusters (K) when not provided.
}
\details{
Steps performed:
\enumerate{
\item Convert the input to a matrix.
\item Convert counts to relative abundance per sample
(each column sums to 1).
\item Compute a distance matrix between samples using Euclidean distance
on transposed relative abundance (\code{dist(t(mat_rel))}).
\item Perform hierarchical clustering with method \code{"ward.D2"}.
\item If \code{k} is \code{NULL}, estimate the best K by fitting PAM
clustering models for K = 2,...,K_max and choosing the K that
maximizes the average silhouette width.
\item Fit the final PAM model with \code{best_k} clusters and extract the
cluster assignments.
\item Order samples according to the hierarchical clustering dendrogram and
reorder the relative abundance matrix accordingly.
}

Requires the \pkg{cluster} package for \code{cluster::pam()}.
}
\examples{
\dontrun{
res <- cluster_samples(abundance_df = otu_table)
}
}
