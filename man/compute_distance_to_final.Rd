% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/nasalPkgFunctions.R
\name{compute_distance_to_final}
\alias{compute_distance_to_final}
\title{Compute distance to the final time point (TF) within each SynCom}
\usage{
compute_distance_to_final(
  meta,
  X,
  method = "bray",
  mode = c("centroid", "replicate", "allpair_mean")
)
}
\arguments{
\item{meta}{Metadata data frame (typically \code{prepare_data()$meta}) with sample IDs
and SynCom/time/replicate information. Must correspond row-for-row to \code{X}.}

\item{X}{Numeric matrix of samples x taxa (rows are samples). Must correspond row-for-row
to \code{meta}. Typically \code{prepare_data()$X}.}

\item{method}{Character. Distance method passed to \code{vegan::vegdist()}
(default \code{"bray"}).}

\item{mode}{Character. How to define the TF reference:
\code{"centroid"}, \code{"replicate"}, or \code{"allpair_mean"}.}
}
\value{
A list with:
\itemize{
\item \code{per_sample}: tibble with one row per sample, including \code{dist_to_TF}
and the key metadata columns.
\item \code{summary}: tibble summarized per \code{syncom_id x time_label x time_num}
with mean, SD, and sample counts.
}
}
\description{
Quantifies "stabilization" by measuring, for each sample, its dissimilarity to
the SynCom-specific final state (TF). Distances are computed within each SynCom
using \code{vegan::vegdist()} (default Bray-Curtis), and summarized per SynCom
and time point.
}
\details{
Three modes are supported:
\itemize{
\item \code{"centroid"}: distance from each sample to the TF centroid (mean profile).
\item \code{"replicate"}: distance from each sample to the TF sample(s) with the
same replicate ID; falls back to centroid if no match exists.
\item \code{"allpair_mean"}: mean distance from each sample to all TF replicates.
}

\strong{Required metadata fields}
The function expects \code{meta} to include:
\code{sample_id}, \code{syncom_id}, \code{time_label}, \code{time_num}, \code{rep_raw}.
If any are missing, it attempts to create them from:
\code{ATTRIBUTE_SynCom}, \code{ATTRIBUTE_Time}, \code{ATTRIBUTE_Replicate}.

\strong{TF detection}
TF samples are those with \code{time_label == "TF"} within each SynCom. If a SynCom
has no TF samples, distances for that SynCom are returned as \code{NA}.

\strong{Computation notes}
\itemize{
\item \code{"centroid"} uses \code{colMeans()} across TF samples as the reference vector.
\item \code{"replicate"} matches TF sample(s) by replicate ID; if multiple matches are
found, their distances are averaged; if none, the TF centroid is used.
\item \code{"allpair_mean"} averages the distances to all TF replicates.
}
}
\examples{
\dontrun{
prep <- prepare_data(abund, meta)
out <- compute_distance_to_final(prep$meta, prep$X, method = "bray", mode = "centroid")
head(out$per_sample)
out$summary
}

}
