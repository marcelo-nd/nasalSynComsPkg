% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/nasalPkgFunctions.R
\name{cluster_barplot_panels}
\alias{cluster_barplot_panels}
\title{Create Relative Abundance Barplots by Cluster}
\usage{
cluster_barplot_panels(
  abundance_df,
  cluster_df,
  sample_order = NULL,
  colour_palette = NULL,
  strains = FALSE,
  best_k = NULL
)
}
\arguments{
\item{abundance_df}{A matrix or data frame of relative abundances with
taxa (e.g., species or strain labels) in rows and samples in columns.
Row names are used as the \code{Bacteria} identifiers in the plot.}

\item{cluster_df}{A data frame containing at least two columns:
\code{Sample} (sample IDs matching the column names of \code{abundance_df})
and \code{Cluster} (cluster assignment for each sample).}

\item{sample_order}{Optional character vector specifying the order of
samples (column names of \code{abundance_df}) to be used on the x-axis.
If \code{NULL}, the original column order of \code{abundance_df} is used.}

\item{colour_palette}{Optional named character vector of colors used to
fill taxa. Names must match the \code{Bacteria} values (i.e., row names of
\code{abundance_df}). If \code{NULL}, ggplot2's default color palette is
used.}

\item{strains}{Logical. If \code{TRUE}, the function assumes that
\code{Bacteria} names encode strain information in the last numeric token
(e.g., \code{"Corynebacterium propinquum 1"}) and will represent species
by fill color and strains by bar patterns. Default is \code{FALSE}.}

\item{best_k}{Integer or character. The number of clusters (k) to display in
the plot title. This argument must be provided; otherwise, the function
will stop with an error.}
}
\value{
A list with two elements:
\describe{
\item{plot}{A \code{ggplot} object representing the relative abundance
barplot faceted by cluster.}
\item{df_long}{A data frame in long format containing the abundance data,
cluster annotations, and (optionally) species/strain columns used for
plotting.}
}
}
\description{
Creates a stacked relative abundance barplot with one panel per cluster.
Samples are grouped by their assigned cluster and displayed as stacked bars
of bacterial relative abundance. Optionally, strain-level information can be
encoded using fill colors for species and patterns for strains.
}
\details{
This function:
\itemize{
\item Orders the abundance matrix according to \code{sample_order}
if provided.
\item Optionally converts strain names to numeric strain IDs using
\code{strain_name2strain_number()} when \code{strains = TRUE}.
\item Reshapes the abundance matrix to long format and merges it with
\code{cluster_df} via the \code{Sample} column.
\item When \code{strains = FALSE}, creates a standard stacked barplot of
taxa relative abundances per sample, faceted by cluster.
\item When \code{strains = TRUE}, uses \pkg{ggpattern} to encode species
as fill colors and strains as patterns within each stacked bar.
}

The function relies on \pkg{ggplot2}, \pkg{reshape2}, \pkg{dplyr},
\pkg{ggpattern}, and a user-defined helper
\code{strain_name2strain_number()} that converts strain names to numeric
strain labels.
}
\examples{
\dontrun{
# Basic usage (no strain patterns, default colors)
res <- cluster_barplot_panels(
  abundance_df = abundance_mat,
  cluster_df   = sample_clusters,
  best_k       = 4
)
res$plot

# With custom sample order and custom colors
res <- cluster_barplot_panels(
  abundance_df   = abundance_mat,
  cluster_df     = sample_clusters,
  sample_order   = c("S1", "S2", "S3"),
  colour_palette = my_colors,
  best_k         = 4
)

# With strain-level encoding (requires strain_name2strain_number())
res <- cluster_barplot_panels(
  abundance_df = abundance_mat,
  cluster_df   = sample_clusters,
  strains      = TRUE,
  best_k       = 4
)
}

}
