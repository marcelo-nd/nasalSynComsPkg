% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/nasalPkgFunctions.R
\name{barplot_from_feature_table}
\alias{barplot_from_feature_table}
\title{Create a Relative Abundance Barplot from a Feature Table}
\usage{
barplot_from_feature_table(
  feature_table,
  sort_type = "none",
  feature_to_sort = NULL,
  strains = FALSE,
  plot_title = "",
  plot_title_size = 14,
  x_axis_text_size = 12,
  x_axis_title_size = 12,
  x_axis_text_angle = 0,
  y_axis_title_size = 12,
  y_axis_text_size = 12,
  y_axis_text_angle = 90,
  legend_pos = "right",
  legend_title_size = 12,
  legend_text_size = 12,
  legend_cols = 3,
  x_vjust = 0.5,
  x_hjust = 1,
  transform_table = TRUE,
  colour_palette = NULL,
  replace_c = FALSE
)
}
\arguments{
\item{feature_table}{A numeric matrix or data frame where rows represent
features (e.g., species or strains) and columns represent samples.
Row names are assumed to be feature identifiers.}

\item{sort_type}{Character string specifying how to order samples on the
x-axis. One of:
\itemize{
\item \code{"none"} (default): keep the original column order.
\item \code{"feature_value"}: order samples by the relative contribution
of a given feature (see \code{feature_to_sort}).
\item \code{"similarity"}: order samples according to hierarchical
clustering via \code{\link{order_samples_by_clustering}}.
}}

\item{feature_to_sort}{Character string giving the feature (row name) used
for ordering samples when \code{sort_type = "feature_value"}. Ignored
otherwise.}

\item{strains}{Logical. If \code{TRUE}, treats row names as strain-level
identifiers of the form \code{"Genus species strainID"} and uses
\code{\link{strain_name2strain_number}} plus pattern aesthetics
(\pkg{ggpattern}) to represent strains; species are encoded as fill colors.
Default is \code{FALSE}.}

\item{plot_title}{Character. Overall plot title. (Note: currently only the
theme title size is controlled; you can extend to use this string explicitly
if desired.) Default is \code{""}.}

\item{plot_title_size}{Numeric. Text size for the plot title. Default is
\code{14}.}

\item{x_axis_text_size}{Numeric. Text size for x-axis tick labels. Default
is \code{12}.}

\item{x_axis_title_size}{Numeric. Text size for the x-axis title. Default
is \code{12}.}

\item{x_axis_text_angle}{Numeric. Rotation angle (degrees) for x-axis tick
labels. Default is \code{0}.}

\item{y_axis_title_size}{Numeric. Text size for the y-axis title. Default
is \code{12}.}

\item{y_axis_text_size}{Numeric. Text size for y-axis tick labels. Default}

\item{y_axis_text_angle}{Numeric. Rotation angle (degrees) for y-axis tick
labels. Default is \code{90}.}

\item{legend_pos}{Character string specifying the legend position (e.g.,
\code{"right"}, \code{"bottom"}, \code{"none"}). Default is \code{"right"}.}

\item{legend_title_size}{Numeric. Text size for the legend title. Default is
\code{12}.}

\item{legend_text_size}{Numeric. Text size for legend text. Default is
\code{12}.}

\item{legend_cols}{Integer. Number of columns in the legend for the
\code{fill} aesthetic. Default is \code{3}.}

\item{x_vjust}{Numeric. Vertical justification for x-axis text. Default is
\code{0.5}.}

\item{x_hjust}{Numeric. Horizontal justification for x-axis text. Default
is \code{1}.}

\item{transform_table}{Logical. If \code{TRUE} and \code{sort_type =
  "similarity"}, the feature table is transformed using
\code{\link{transform_feature_table}} with method \code{"min_max"} prior
to clustering. Default is \code{TRUE}.}

\item{colour_palette}{Optional named character vector of colors to use for
features (or species groups). If \code{NULL}, a palette is generated with
\code{\link{get_palette}}. When \code{strains = TRUE}, the palette is
applied to \code{species2}.}

\item{replace_c}{Logical. Passed to \code{\link{get_palette}} as
\code{replace_cols}, controlling whether colors may be sampled with
replacement when generating a palette. Default is \code{FALSE}.}
}
\value{
A \code{ggplot} object representing the relative abundance barplot.
}
\description{
Generates a stacked relative abundance barplot from a single feature table
(e.g., OTU/ASV or species-by-sample table), with several options for sorting
samples and optionally encoding strain-level information using patterns.
}
\details{
The function proceeds in several steps:
\itemize{
\item Filters out rows (features) with zero counts using
\code{\link{filter_features_by_col_counts}}.
\item Removes samples (columns) that are all zeros.
\item Optionally converts strain-level row names into a standardized
species + numeric strain ID format with
\code{\link{strain_name2strain_number}}.
\item Depending on \code{sort_type}, orders samples by:
\itemize{
\item original column order (\code{"none"}),
\item decreasing relative contribution of a specific feature
(\code{"feature_value"}),
\item similarity-based clustering
(\code{"similarity"}, via \code{\link{order_samples_by_clustering}}).
}
\item Reshapes the data into long format with columns \code{species},
\code{sample}, and \code{abundance}. When \code{strains = TRUE},
also creates \code{strain} and \code{species2} columns.
\item Filters out zero and \code{NA} abundances, and, if applicable,
invalid strain entries.
\item Constructs a stacked barplot with relative abundances
(\code{position = "fill"}), using either:
\itemize{
\item \pkg{ggpattern} to encode strains via patterns and species
via fill colors, or
\item standard stacked bars colored by species.
}
}
}
\examples{
\dontrun{
# Basic usage (no sorting)
p <- barplot_from_feature_table(feature_table = abundance_mat)
p

# Sort samples by the relative contribution of a given species
p <- barplot_from_feature_table(
  feature_table   = abundance_mat,
  sort_type       = "feature_value",
  feature_to_sort = "Corynebacterium propinquum"
)

# Sort samples by similarity (clustering-based order)
p <- barplot_from_feature_table(
  feature_table = abundance_mat,
  sort_type     = "similarity",
  transform_table = TRUE
)

# Strain-level visualization with patterns (requires ggpattern)
p <- barplot_from_feature_table(
  feature_table = strain_level_mat,
  strains       = TRUE
)
}

}
