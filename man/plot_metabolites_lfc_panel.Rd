% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/nasalPkgFunctions.R
\name{plot_metabolites_lfc_panel}
\alias{plot_metabolites_lfc_panel}
\title{Plot a faceted panel of metabolite log2 fold-changes vs control}
\usage{
plot_metabolites_lfc_panel(
  df,
  metabolites,
  ctrl_prefix = "CTRL",
  n_rows = 2,
  n_cols = 3,
  replicate_regex = "^[^_]+_\\\\d+$",
  tiny_pseudocount = 0,
  y_limits = c(-10, 10),
  show_guides = TRUE,
  palette = NULL,
  facet_label_width = 28,
  debug = FALSE
)
}
\arguments{
\item{df}{Data frame containing replicate sample columns. Metabolites are
identified by \code{rownames(df)}.}

\item{metabolites}{Character vector of metabolite names to plot. Only those
present in \code{rownames(df)} are used.}

\item{ctrl_prefix}{Character. Control prefix (e.g., \code{"CTRL"}) used as the
denominator for fold-change computations.}

\item{n_rows}{Integer. Number of facet rows.}

\item{n_cols}{Integer. Number of facet columns.}

\item{replicate_regex}{Character. Regex used to detect replicate columns.
Default \code{"^[^_]+_\\\\d+$"} matches names like \code{"A_1"}.}

\item{tiny_pseudocount}{Numeric. Small value added to both numerator and
denominator when computing relative abundance:
\itemize{
\item If \code{> 0}, uses \code{(Abundance + tiny_pseudocount) / (ctrl_mean + tiny_pseudocount)}
to avoid division by zero and stabilize very small values.
\item If \code{0}, uses \code{Abundance / ctrl_mean} and requires \code{ctrl_mean != 0}.
}}

\item{y_limits}{Numeric length-2 vector. If not \code{NULL}, sets y-axis limits
via \code{coord_cartesian(ylim = y_limits)}.}

\item{show_guides}{Logical. If \code{TRUE}, adds horizontal guide lines at
\code{0} (solid) and \code{-2, 2} (dashed), useful as effect-size references.}

\item{palette}{Optional. Either:
\itemize{
\item unnamed vector of colors (must have at least as many colors as samples), or
\item named vector mapping sample prefixes to colors.
}
Applied to both fill and color scales.}

\item{facet_label_width}{Integer. Wrap width for facet strip labels
(metabolite names) using \code{stringr::str_wrap()}.}

\item{debug}{Logical. Reserved for debugging; currently unused.}
}
\value{
A \code{ggplot} object.
}
\description{
Creates a multi-panel (faceted) boxplot + jitter plot showing per-replicate
\eqn{\log_2} fold-changes (sample / CTRL) for a selected set of metabolites.
The function expects a wide data frame where replicate measurements are stored
in separate columns with names like \code{PREFIX_1}, \code{PREFIX_2}, etc.
}
\details{
Workflow overview:
\itemize{
\item Identify replicate columns using \code{replicate_regex}.
\item Convert to long format and extract sample prefixes.
\item Compute per-metabolite control means from \code{ctrl_prefix}.
\item Normalize each replicate value to its metabolite's control mean and
compute \eqn{\log_2} fold-change.
\item Drop CTRL from the plotted samples (CTRL is the denominator), then plot
fold-changes as faceted boxplots/jitter points.
}

\strong{Metabolite matching}
Metabolites are pulled from \code{rownames(df)}. Requested metabolites not
present are ignored; if none are present, the function errors.

\strong{Control mean validity}
Metabolites are excluded from plotting if the control mean is not finite
(e.g., all NA) or if \code{tiny_pseudocount == 0} and \code{ctrl_mean == 0}
(to prevent division by zero). If all requested metabolites are excluded,
the function errors.

\strong{Plot semantics}
The plot shows distributions of replicate-level fold-changes per sample prefix.
CTRL replicates are used only to compute denominators and are not displayed.
}
\examples{
\dontrun{
p <- plot_metabolites_lfc_panel(
  df = metab_wide,
  metabolites = c("Lactic acid", "Acetate", "Succinate"),
  ctrl_prefix = "CTRL",
  n_rows = 2, n_cols = 2,
  tiny_pseudocount = 1e-8,
  y_limits = c(-6, 6),
  palette = c(CTRL = "grey80", A = "#1b9e77", B = "#d95f02") # named palette example
)
p
}

}
